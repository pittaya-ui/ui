{
  "name": "avatar",
  "type": "registry:ui",
  "description": "Displays a user avatar with image, fallback, and group support.",
  "dependencies": [
    "@radix-ui/react-avatar",
    "class-variance-authority"
  ],
  "registryDependencies": [
    "utils"
  ],
  "files": [
    {
      "name": "avatar.tsx",
      "content": "\"use client\";\n\nimport { cva, type VariantProps } from \"class-variance-authority\";\nimport * as React from \"react\";\n\nimport { cn } from \"@/lib/utils\";\n\nconst avatarVariants = cva(\n  \"relative flex shrink-0 overflow-hidden rounded-full\",\n  {\n    variants: {\n      size: {\n        sm: \"h-8 w-8\",\n        md: \"h-10 w-10\",\n        lg: \"h-12 w-12\",\n        xl: \"h-16 w-16\",\n      },\n    },\n    defaultVariants: {\n      size: \"md\",\n    },\n  }\n);\n\n// Context to manage image loading state\ntype AvatarContextValue = {\n  imageStatus: \"idle\" | \"loading\" | \"loaded\" | \"error\";\n  setImageStatus: (status: \"idle\" | \"loading\" | \"loaded\" | \"error\") => void;\n};\n\nconst AvatarContext = React.createContext<AvatarContextValue | null>(null);\n\nconst useAvatarContext = () => {\n  const context = React.useContext(AvatarContext);\n  if (!context) {\n    throw new Error(\"Avatar components must be used within Avatar\");\n  }\n  return context;\n};\n\nexport interface AvatarProps\n  extends Omit<React.HTMLAttributes<HTMLSpanElement>, \"children\">,\n    VariantProps<typeof avatarVariants> {\n  children?: React.ReactNode;\n}\n\nconst Avatar = React.forwardRef<HTMLSpanElement, AvatarProps>(\n  ({ className, size, children, ...props }, ref) => {\n    const [imageStatus, setImageStatus] = React.useState<\n      \"idle\" | \"loading\" | \"loaded\" | \"error\"\n    >(\"idle\");\n\n    return (\n      <AvatarContext.Provider value={{ imageStatus, setImageStatus }}>\n        <span\n          ref={ref}\n          className={cn(avatarVariants({ size, className }))}\n          {...props}\n        >\n          {children}\n        </span>\n      </AvatarContext.Provider>\n    );\n  }\n);\nAvatar.displayName = \"Avatar\";\n\nconst AvatarImage = React.forwardRef<\n  HTMLImageElement,\n  React.ImgHTMLAttributes<HTMLImageElement>\n>(({ className, ...props }, ref) => {\n  const { imageStatus, setImageStatus } = useAvatarContext();\n\n  const handleLoad = (e: React.SyntheticEvent<HTMLImageElement>) => {\n    setImageStatus(\"loaded\");\n    props.onLoad?.(e);\n  };\n\n  const handleError = (e: React.SyntheticEvent<HTMLImageElement>) => {\n    setImageStatus(\"error\");\n    props.onError?.(e);\n  };\n\n  React.useEffect(() => {\n    setImageStatus(\"loading\");\n  }, [setImageStatus]);\n\n  if (imageStatus === \"error\") return null;\n\n  return (\n    <img\n      ref={ref}\n      className={cn(\"aspect-square h-full w-full object-cover\", className)}\n      onLoad={handleLoad}\n      onError={handleError}\n      {...props}\n    />\n  );\n});\nAvatarImage.displayName = \"AvatarImage\";\n\nconst AvatarFallback = React.forwardRef<\n  HTMLSpanElement,\n  React.HTMLAttributes<HTMLSpanElement>\n>(({ className, ...props }, ref) => {\n  const { imageStatus } = useAvatarContext();\n\n  // Only show fallback if there's no image or if the image failed to load\n  if (imageStatus === \"loading\" || imageStatus === \"loaded\") return null;\n\n  return (\n    <span\n      ref={ref}\n      className={cn(\n        \"bg-muted flex h-full w-full items-center justify-center rounded-full text-sm font-medium\",\n        className\n      )}\n      {...props}\n    />\n  );\n});\nAvatarFallback.displayName = \"AvatarFallback\";\n\nexport interface AvatarGroupProps extends React.HTMLAttributes<HTMLDivElement> {\n  max?: number;\n  children: React.ReactNode;\n  size?: \"sm\" | \"md\" | \"lg\" | \"xl\";\n}\n\nconst AvatarGroup = React.forwardRef<HTMLDivElement, AvatarGroupProps>(\n  ({ className, children, max = 3, size = \"md\", ...props }, ref) => {\n    const childrenArray = React.Children.toArray(children);\n    const visibleChildren = max ? childrenArray.slice(0, max) : childrenArray;\n    const remainingCount = childrenArray.length - visibleChildren.length;\n\n    const spacingMap = {\n      sm: \"-space-x-2\",\n      md: \"-space-x-3\",\n      lg: \"-space-x-4\",\n      xl: \"-space-x-5\",\n    };\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\"flex items-center\", spacingMap[size], className)}\n        {...props}\n      >\n        {visibleChildren.map((child, index) => (\n          <div\n            key={index}\n            className=\"ring-background rounded-full ring-2\"\n            style={{ zIndex: visibleChildren.length - index }}\n          >\n            {React.isValidElement(child) &&\n              React.cloneElement(child as React.ReactElement<AvatarProps>, {\n                size,\n              })}\n          </div>\n        ))}\n        {remainingCount > 0 && (\n          <AvatarCount size={size} count={remainingCount} />\n        )}\n      </div>\n    );\n  }\n);\nAvatarGroup.displayName = \"AvatarGroup\";\n\nexport interface AvatarCountProps extends React.HTMLAttributes<HTMLDivElement> {\n  count: number;\n  size?: \"sm\" | \"md\" | \"lg\" | \"xl\";\n}\n\nconst AvatarCount = React.forwardRef<HTMLDivElement, AvatarCountProps>(\n  ({ className, count, size = \"md\", ...props }, ref) => {\n    const sizeMap = {\n      sm: \"h-8 w-8 text-xs\",\n      md: \"h-10 w-10 text-sm\",\n      lg: \"h-12 w-12 text-base\",\n      xl: \"h-16 w-16 text-lg\",\n    };\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"bg-muted ring-background flex items-center justify-center rounded-full font-medium ring-2\",\n          sizeMap[size],\n          className\n        )}\n        style={{ zIndex: 0 }}\n        {...props}\n      >\n        +{count}\n      </div>\n    );\n  }\n);\nAvatarCount.displayName = \"AvatarCount\";\n\nexport { Avatar, AvatarCount, AvatarFallback, AvatarGroup, AvatarImage };\n"
    }
  ]
}